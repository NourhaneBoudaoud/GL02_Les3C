"use strict";var se=Object.create;var I=Object.defineProperty;var ie=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,pe=Object.prototype.hasOwnProperty;var Mt=(t,r)=>{for(var e in r)I(t,e,{get:r[e],enumerable:!0})},It=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of ae(r))!pe.call(t,n)&&n!==e&&I(t,n,{get:()=>r[n],enumerable:!(o=ie(r,n))||o.enumerable});return t};var m=(t,r,e)=>(e=t!=null?se(me(t)):{},It(r||!t||!t.__esModule?I(e,"default",{value:t,enumerable:!0}):e,t)),le=t=>It(I({},"__esModule",{value:!0}),t);var ho={};Mt(ho,{CaporalValidator:()=>T,Command:()=>H,OptionValueType:()=>W,Program:()=>M,chalk:()=>ne.default,default:()=>fo,parseArgv:()=>S,parseLine:()=>gr,program:()=>oe});module.exports=le(ho);var Xr=require("events"),Zr=m(require("fs")),te=m(require("path")),re=m(require("lodash/kebabCase")),ee=m(require("lodash/mapKeys"));var _t=m(require("lodash/reduce"));var l=class extends Error{constructor(e,o={}){super(e);Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name,this.meta=o,Error.captureStackTrace(this,this.constructor)}};var j=class extends l{constructor(r){let e=typeof r=="string"?r:r.message;super(e,{error:r})}};var O=require("winston"),Gt=require("util"),w=m(require("chalk")),Dt=m(require("lodash/replace")),N=require("os"),jt=O.format.printf(t=>{let{level:r,...e}=t,{message:o}=t,n="",s=ue(r),i=de(e);if(i!==""&&(o+=`${N.EOL}${s}: ${i}`),r==="error"){let a=" ".repeat(e.paddingLeft||7);n=N.EOL,o=`${(0,Dt.default)(o,new RegExp(N.EOL,"g"),N.EOL+a)}${N.EOL}`}return`${n}${s}: ${o}`});function de(t){return delete t.message,delete t[Symbol.for("level")],delete t[Symbol.for("message")],delete t[Symbol.for("splat")],Object.keys(t).length?(0,Gt.inspect)(t,{showHidden:!1,colors:c.colorsEnabled}):""}function ue(t){if(!c.colorsEnabled)return t;let r=t;switch(t){case"error":r=w.default.bold.redBright(t);break;case"warn":r=w.default.hex("#FF9900")(t);break;case"info":r=w.default.hex("#569cd6")(t);break;case"debug":case"silly":r=w.default.dim(t);break}return r}var c=ce();function $t(t){c=t}function Ft(){return c}function ce(){let t=(0,O.createLogger)({transports:[new O.transports.Console({format:O.format.combine(O.format.splat(),jt)})]});return t.disableColors=()=>{t.transports[0].format=jt,t.colorsEnabled=!1},t.colorsEnabled=w.supportsColor!==!1,t}function zt(t){c.level=="debug"?c.log({level:"error",...t,message:t.message+`

`+t.stack,stack:t.stack,name:t.name}):c.error(t.message),process.exitCode=1}var _=class extends l{constructor(r){super("Caporal setup error: Invalid flag validator setup.",{validator:r})}};var qt=m(require("chalk")),G=class extends l{constructor(r,e){let o=`Missing required argument ${qt.default.bold(r.name)}.`;super(o,{argument:r,command:e})}};var Wt=m(require("chalk")),D=class extends l{constructor(r,e){let o=`Missing required flag ${Wt.default.bold(r.allNotations.join(" | "))}.`;super(o,{flag:r,command:e})}};var Ut=m(require("chalk"));var k=m(require("chalk"));function $(t){return t.replace(/<([^>]+)>/gi,r=>k.default.hex("#569cd6")(r)).replace(/<command>/gi,r=>k.default.hex("#ff9900")(r)).replace(/\[([^[\]]+)\]/gi,r=>k.default.hex("#aaa")(r)).replace(/ --?([^\s,]+)/gi,r=>k.default.green(r))}var F=class extends l{constructor(r,e){let n=`The following error${e.length>1?"s":""} occured:
`+e.map(s=>"- "+s.message.replace(/\n/g,`
  `)).join(`
`)+`

`+Ut.default.dim("Synopsis: ")+$(r.synopsis);super(n,{errors:e})}};var z=class extends l{constructor(r){let e;r&&!r.isProgramCommand()?e=`Caporal Error: You haven't defined any action for command '${r.name}'.
Use .action() to do so.`:e=`Caporal Error: You haven't defined any action for program.
Use .action() to do so.`,super(e,{cmd:r})}};var q=class extends l{constructor(r){super(`Syntax error in option synopsis: ${r}`,{synopsis:r})}};var Kt=m(require("lodash/camelCase")),Jt=m(require("lodash/kebabCase"));var T=(n=>(n[n.NUMBER=1]="NUMBER",n[n.BOOLEAN=2]="BOOLEAN",n[n.STRING=4]="STRING",n[n.ARRAY=8]="ARRAY",n))(T||{}),W=(o=>(o[o.Optional=0]="Optional",o[o.Required=1]="Required",o[o.None=2]="None",o))(W||{});var ge=/^-[a-z]$/i,fe=/^--[a-z]{2,}/i,he=/^(-[a-zA-Z]|--\D{1}[\w-]+)/;function Ce(t){return ge.test(t)}function ye(t){return fe.test(t)}function Yt(t){return t.length===1?t:(0,Kt.default)(t)}function U(t,r=!0){return t=t.replace(/([[\]<>]+)/g,"").replace("...","").replace(/^no-/,""),r?Yt(t):t}function K(t){let r=Math.min(t.length,2);return"-".repeat(r)+(0,Jt.default)(t)}function J(t){return!isNaN(parseFloat(t))&&isFinite(Number(t))}function R(t){return t!==void 0&&t!=="--"&&he.test(t)}function Qt(t){return t.match(/^-([a-z]{2,})/i)?t.substr(1).split(""):!1}function Xt(t){return t.substr(0,5)==="--no-"}function Zt(t){return Array.isArray(t)}function gt(t){return Yt(t.replace(/^--?(no-)?/,""))}function tr(t){let r={variadic:!1,valueType:2,valueRequired:!1,allNames:[],allNotations:[],name:"",notation:"",synopsis:t},e=t.split(/[\s\t,]+/).reduce((n,s)=>(ye(s)?(n.longNotation=s,n.longName=U(s.substring(2)),n.allNames.push(n.longName),n.allNotations.push(s)):Ce(s)?(n.shortNotation=s,n.shortName=s.substring(1),n.allNames.push(n.shortName),n.allNotations.push(s)):s.substring(0,1)==="["?(n.valueType=0,n.valueRequired=!1,n.variadic=s.substr(-4,3)==="..."):s.substring(0,1)==="<"&&(n.valueType=1,n.valueRequired=!0,n.variadic=s.substr(-4,3)==="..."),n),r);if(e.longName===void 0&&e.shortName===void 0)throw new q(t);return e.name=e.longName||e.shortName,e.notation=e.longNotation||e.shortNotation,{...e}}var rr=m(require("lodash/isNumber"));function P(t){return typeof t!="number"?!1:(Pe()&t)===t}function ft(t){return P(t)&&!!(t&1)}function B(t){return P(t)&&!!(t&4)}function b(t){return P(t)&&!!(t&2)}function er(t){return P(t)&&!!(t&8)}function Pe(){return Object.values(T).filter(rr.default).reduce((t,r)=>t|r,0)}function Oe(t){if(!P(t))throw new _(t)}function be(t){if(typeof t!="function"&&!(t instanceof RegExp)&&!Array.isArray(t))throw new _(t)}function Y(t){t!==void 0&&(typeof t=="number"?Oe(t):be(t))}function Q(t){let r;if(b(t.validator)||"boolean"in t&&t.boolean&&t.default!==!1)r="boolean";else if(ft(t.validator))r="number";else if(Array.isArray(t.validator)){let e=JSON.stringify(t.validator);e.length<300&&(r="one of "+e.substr(1,e.length-2))}return r}var pr=m(require("lodash/replace")),lr=m(require("chalk"));var X=require("table"),or=m(require("lodash/filter"));function nr(t,r={}){return(0,X.table)(t,{border:(0,X.getBorderCharacters)("void"),columnDefault:{paddingLeft:0,paddingRight:2},columns:{0:{paddingLeft:4,width:35},1:{width:55,wrapWord:!0,paddingRight:0}},drawHorizontalLine:()=>!1,...r})}function sr(t){return t.default!==void 0&&!("boolean"in t&&t.boolean&&t.default===!1)?"default: "+JSON.stringify(t.default):void 0}function Ae(t,{eol:r,chalk:e}){return t.synopsis+(t.required&&t.default===void 0?r+e.dim("required"):"")}function L(t,r,e="OPTIONS"){if(t=(0,or.default)(t,"visible"),!t.length)return"";let{chalk:o,eol:n,table:s,spaces:i}=r,a=i+o.bold(e)+n+n,p=t.map(d=>{let u=sr(d),f=[d.typeHint,u].filter(E=>E).join(", "),y=Ae(d,r),x=d.description+(f.length?n+o.dim(f):"");return[y,x]});return a+s(p)}function ir(t,r,e="ARGUMENTS"){if(!t.length)return"";let{chalk:o,eol:n,eol2:s,table:i,spaces:a}=r,p=a+o.bold(e)+s,d=t.map(u=>{let f=sr(u),y=[u.typeHint,f].filter(E=>E).join(", "),x=u.description+(y.length?n+o.dim(y):"");return[u.synopsis,x]});return p+i(d)}function ar(t,r,e="COMMANDS"){let{chalk:o,prog:n,eol2:s,table:i,spaces:a}=r,p=`Type '${n.getBin()} help <command>' to get some help about a command`,d=a+o.bold(e)+` ${o.dim("\u2014")} `+o.dim(p)+s,u=t.filter(f=>f.visible).map(f=>[o.hex("#ff9900")(f.name),f.description||""]);return d+i(u)}var ht={};Mt(ht,{command:()=>xe,custom:()=>Ee,header:()=>we,program:()=>Te,usage:()=>ve});var mr=m(require("lodash/sortBy")),xe=async t=>{let{cmd:r,globalOptions:e,eol:o,eol3:n,colorize:s,tpl:i}=t,a=(0,mr.default)(r.options,"name"),p=Array.from(e.keys()),d=r.synopsis+n+await i("custom",t)+ir(r.args,t)+o+L(a,t)+o+L(p,t,"GLOBAL OPTIONS");return s(d)};var we=t=>{let{prog:r,chalk:e,spaces:o,eol:n,eol2:s}=t,i=process.env?.NODE_ENV==="test"?"":r.getVersion();return n+o+(r.getName()||r.getBin())+" "+(i||"")+(r.getDescription()?" \u2014 "+e.dim(r.getDescription()):"")+s};var Te=async t=>{let{prog:r,globalOptions:e,eol:o,eol3:n,colorize:s,tpl:i}=t,a=await r.getAllCommands(),p=Array.from(e.keys()),d=await r.getSynopsis()+n+await i("custom",t)+ar(a,t)+o+L(p,t,"GLOBAL OPTIONS");return s(d)};var ve=async t=>{let{tpl:r,prog:e,chalk:o,spaces:n,eol:s}=t,{cmd:i}=t;!i&&!await e.hasCommands()&&(t.cmd=i=e.progCommand);let a=`${n+o.bold("USAGE")} ${i?.name?"\u2014 "+o.dim(i.name):""}
  ${s+n+n+o.dim("\u25B8")} `,p=i?await r("command",t):await r("program",t);return a+p};var Ee=t=>{let{prog:r,cmd:e,eol2:o,eol3:n,chalk:s,colorize:i,customHelp:a,indent:p}=t,d=a.get(e||r);if(d){let u=d.map(({text:f,options:y})=>{let x="";y.sectionName&&(x+=s.bold(y.sectionName)+o);let E=y.colorize?i(f):f;return x+=y.sectionName?p(E):E,x+n}).join("");return p(u)+n}return""};var Ne=new Map(Object.entries(ht)),Ct=new Map;function Z(t,r,e){let o={sectionName:"",colorize:!0,...e},n=Ct.get(t)||[];n.push({text:r,options:o}),Ct.set(t,n)}async function yt(t,r){let e=Ne.get(t);if(!e)throw Error(`Caporal setup error: Unknown help template '${t}'`);return e(r)}function Re(t,r){let e=" ".repeat(2);return{prog:t,cmd:r,chalk:lr.default,colorize:$,customHelp:Ct,tpl:yt,globalOptions:A(),table:nr,spaces:e,indent(n,s=e){return s+(0,pr.default)(n.trim(),/(\r\n|\r|\n)/g,`
`+s)},eol:`
`,eol2:`

`,eol3:`


`}}async function dr(t,r){let e=Re(t,r);return[await yt("header",e),await yt("usage",e)].join("")}var Tt=m(require("tabtab"));var ur=m(require("lodash/invert")),cr=m(require("lodash/findIndex"));var Se="--";function tt(t){return t===Se}function Ve(t){return typeof t=="boolean"?t:/^true|1|yes|on$/.test(t)}function _e(t){return t+""}function Ot(t){return/^true|false$/.test(t)?t==="true":J(t)?parseFloat(t):t}function Pt(t,r,e){let o=gt(t);return e.string.includes(o)?_e(r):e.boolean.includes(o)||typeof r=="boolean"?Ve(r):e.autoCast?Ot(r):r}function gr(t,r={}){return S(r,t.split(" "))}function ke(t){let r=t.indexOf("--"),e=(0,cr.default)(t,R);return r<e&&r!==-1?-1:e}var bt=class{constructor(r){this.argv=r;this.ddashHandled=!1;this.cursor=0}toJSON(){return{cursor:this.cursor,ddashHandled:this.ddashHandled,current:this.current,argv:this.argv}}markDdashHandled(){return this.ddashHandled=!0,this}hasDdashHandled(){return this.ddashHandled}next(){return this.argv[this.cursor+1]}slice(r,e){return this.argv.slice(r,e)}sliceFromHere(r){return this.slice(this.cursor,r)}forward(r=1){return r===-1?this.end():(this.cursor+=r,!0)}end(){return this.cursor=this.length,!0}get current(){return this.argv[this.cursor]}get length(){return this.argv.length}},At=class{constructor(r,e){this.config=r;this.args=[];this.ddash=[];this.key="args";this.line=e.join(" "),this.rawArgv=e}toJSON(){return{args:this.args,ddash:this.ddash,rawArgv:this.rawArgv,line:this.line}}inVariadicContext(){let r=this[this.key].length;if(this.config.variadic.includes(r)&&(this.variadicId=r),this.variadicId!==void 0)return!0}markDdashHandled(r){return this.config.ddash&&(this.key="ddash"),r.markDdashHandled().forward()}push(...r){return this[this.key].push(...r.map(this.config.autoCast?Ot:String)),!0}pushVariadic(r){let e=r.sliceFromHere(),o=ke(e);return this.variadicId=this.variadicId||0,(this[this.key][this.variadicId]=this[this.key][this.variadicId]||[]).push(...e.slice(0,o===-1?void 0:o).filter(s=>!tt(s)).map(this.config.autoCast?Ot:String)),r.forward(o)}visit(r){return!r.current||R(r.current)&&!r.hasDdashHandled()?!1:tt(r.current)?this.markDdashHandled(r):this.inVariadicContext()?this.pushVariadic(r):(this.push(r.current),r.forward())}},xt=class{constructor(r){this.config=r;this.options={};this.rawOptions={}}toJSON(){return{options:this.options,rawOptions:this.rawOptions}}handleOptWithoutValue(r,e){let o=e.next(),n=R(o)||tt(o)||o===void 0;this.compute(r,Pt(r,n?!0:o,this.config)),n||e.forward()}handleConcatenatedOpts(r,e,o){if(o===void 0){o=!0;let n=r.next(),s=e[e.length-1],i=this.config.alias[s];n&&!R(n)&&!tt(n)&&!this.isBoolean(s,i)&&(r.forward(),o=n)}this.computeMulti(e,o)}visit(r){if(!r.current||!R(r.current)||r.hasDdashHandled())return!1;let[e,o]=r.current.split("=",2),n=Qt(e);return n?this.handleConcatenatedOpts(r,n,o):o?this.compute(e,Pt(e,o,this.config)):this.handleOptWithoutValue(e,r),r.forward()}compute(r,e){let o=Xt(r),n=gt(r),s=this.config.alias[n];if(this.isVariadic(n,s)){let i=this.options[n];this.rawOptions[r]=this.options[n]=(Zt(i)?i:[i]).concat(e)}else this.rawOptions[r]=this.options[n]=o?!e:e;s&&(this.options[s]=this.options[n])}computeMulti(r,e){let o=r.length;r.forEach((n,s)=>{let i=this.config.alias[n];this.options[n]=s+1===o?Pt(n,e,this.config):!0,this.rawOptions["-"+n]=this.options[n],i&&(this.options[i]=this.options[n])})}isVariadic(r,e){return r in this.options&&(this.config.variadic.includes(r)||this.config.variadic.includes(e))}isBoolean(r,e){return this.config.boolean.includes(r)||this.config.boolean.includes(e)}};function S(t={},r=process.argv.slice(2)){let e={autoCast:!0,ddash:!1,alias:{},boolean:[],string:[],variadic:[],...t};e.alias={...e.alias,...(0,ur.default)(e.alias)};let o=new bt(r),n=new xt(e),s=new At(e,r),i=[s,n];for(;o.current;)i.some(a=>a.visit(o));return{...n.toJSON(),...s.toJSON()}}var wt=m(require("path"));async function rt(t){let{dir:r,name:e}=wt.default.parse(t),n=await import(wt.default.join(r,e));return n.default??n}var fr=m(require("path"));async function et(t,r){let e=t.getCommands(),o=i=>e.find(a=>a.name===i||a.hasAlias(i)),n,s;for(s=0;s<r.length;s++){let i=r.slice(0,s+1).join(" ");if(r[s].startsWith("-"))break;n=o(i)||await Be(t,i)||n}return n}async function Be(t,r){if(t.discoveryPath===void 0)return;let e=r.split(" ").join("/");try{let o=fr.default.join(t.discoveryPath,e),n=await rt(o),s={createCommand:v.bind(null,t,r),program:t};return n(s)}catch{}}var Le=m(require("lodash/filter")),He=m(require("lodash/flatMap")),Me=new Map;function hr(t,r){Me.set(t,r)}async function Cr(t){return Tt.default.install({name:t.getBin(),completer:t.getBin()})}async function yr(t){return Tt.default.uninstall({name:t.getBin()})}function h(t,r,e={}){let{validator:o,required:n,hidden:s}=e;n=!!n,Y(o);let i=tr(t),a=i.valueType===2||b(o);o&&!b(o)&&(a=!1);let p={kind:"option",default:a==!0?!!e.default:e.default,description:r,choices:Array.isArray(o)?o:[],...i,required:n,visible:!s,boolean:a,validator:o};return p.typeHint=Q(p),p}var Et=async({program:t,command:r})=>{let e=await dr(t,r);return console.log(e),t.emit("help",e),!1},Ie=({program:t})=>(console.log(t.getVersion()),t.emit("version",t.getVersion()),!1),je=({logger:t})=>{t.disableColors()},Ge=({logger:t})=>{t.level="silly"},De=({logger:t})=>{t.level="warn"},$e=({logger:t})=>{t.silent=!0},Fe=({program:t})=>Cr(t),ze=({program:t})=>yr(t),vt;function A(){return vt===void 0&&(vt=qe()),vt}function qe(){let t=h("-h, --help","Display global help or command-related help."),r=h("-v, --verbose","Verbose mode: will also output debug messages."),e=h("--quiet","Quiet mode - only displays warn and error messages."),o=h("--silent","Silent mode: does not output anything, giving no indication of success or failure other than the exit code."),n=h("-V, --version","Display version."),s=h("--no-color","Disable use of colors in output."),i=h("--install-completion","Install completion for your shell.",{hidden:!0}),a=h("--uninstall-completion","Uninstall completion for your shell.",{hidden:!0});return new Map([[t,Et],[n,Ie],[s,je],[r,Ge],[e,De],[o,$e],[i,Fe],[a,ze]])}function Or(t){let r=A();for(let[e]of r)if(e.allNames.includes(t)||e.allNotations.includes(t))return r.delete(e);return!1}function br(t,r){return A().set(t,r)}async function ot(t,r,e){let{options:o}=t,n={...t,logger:c,program:r,command:e},s=Object.entries(o).map(([a])=>{let p=We(a);if(p)return p(n)});return(await Promise.all(s)).some(a=>a===!1)}function We(t){for(let[r,e]of A())if(r.allNames.includes(t))return e}function Ar(t){for(let[r]of A())if(r.allNames.includes(t))return r}var wr=m(require("chalk"));function xr(t,r){if(t===r)return 0;if(!t.length||!r.length)return t.length||r.length;let e=0,o=0,n=0,s=[...Array(r.length+1).keys()];for(let i=0;i<t.length;i++){n=i,o=i+1;for(let a=0;a<r.length;a++)e=t[i]===r[a]?n:Math.min(n,s[a+1],o)+1,n=s[a+1],s[a]=o,o=e;s[s.length-1]=e}return e}var Ue=2,Ke=(t,r)=>t.distance-r.distance,Je=t=>t.distance<=Ue,Ye=(t,r)=>({suggestion:r,distance:xr(t,r)});function nt(t,r){return r.map(e=>Ye(t,e)).filter(Je).sort(Ke).map(e=>e.suggestion)}function st(t,r){return[...r].map((e,o)=>e!=t.charAt(o)?wr.default.bold.greenBright(e):e).join("")}var Tr=m(require("chalk")),vr=m(require("lodash/fp/filter")),Er=m(require("lodash/fp/map")),it=class extends l{constructor(r,e){let o=(0,vr.default)(p=>p.name.length>1),n=(0,Er.default)(p=>p.name),s=n([...o(e.options),...A().keys()]),i=nt(r,s),a=`Unknown option ${Tr.default.bold.redBright(K(r))}. `;i.length&&(a+="Did you mean "+i.map(p=>st(K(r),K(p))).join(" or maybe ")+" ?"),super(a,{flag:r,command:e})}};var at=m(require("chalk")),Nr=m(require("lodash/flatMap")),Rr=m(require("lodash/filter")),mt=class extends l{constructor(r,e){let o=(0,Rr.default)((0,Nr.default)(r.getCommands(),s=>[s.name,...s.getAliases()])),n="";if(e){n=`Unknown command ${at.default.bold(e)}.`;let s=nt(e,o);s.length&&(n+=" Did you mean "+s.map(i=>st(e,i)).join(" or maybe ")+" ?")}else n=`Unspecified command. Available commands are:
`+o.map(s=>at.default.whiteBright(s)).join(", ")+`.

For more help, type ${at.default.whiteBright(r.getBin()+" --help")}`;super(n,{command:e})}};var V=require("util"),g=m(require("chalk"));function Sr(t){return"allNotations"in t}var C=class extends l{constructor({value:r,error:e,validator:o,context:n}){let s=e instanceof Error?e.message:e,i=Sr(n)?"option":"argument",a=Sr(n)?n.allNotations.join("|"):n.synopsis;if(P(o))switch(o){case 1:s=(0,V.format)(`Invalid value for %s %s.
Expected a %s but got "%s".`,i,g.default.redBright(a),g.default.underline("number"),g.default.redBright(r));break;case 2:s=(0,V.format)(`Invalid value for %s %s.
Expected a %s (true, false, 0, 1), but got "%s".`,i,g.default.redBright(a),g.default.underline("boolean"),g.default.redBright(r));break;case 4:s=(0,V.format)(`Invalid value for %s %s.
Expected a %s, but got "%s".`,i,g.default.redBright(a),g.default.underline("string"),g.default.redBright(r));break}else Array.isArray(o)?s=(0,V.format)(`Invalid value for %s %s.
Expected one of %s, but got "%s".`,i,g.default.redBright(a),"'"+o.join("', '")+"'",g.default.redBright(r)):o instanceof RegExp&&(s=(0,V.format)(`Invalid value for %s %s.
Expected a value matching %s, but got "%s".`,i,g.default.redBright(a),g.default.whiteBright(o.toString()),g.default.redBright(r)));super(s+"")}};var Vr=require("util"),pt=m(require("chalk")),lt=class extends l{constructor(r,e,o){let n=e.min===e.max?`exactly ${e.min}.`:`between ${e.min} and ${e.max}.`,s=r.isProgramCommand()?"":`for command ${pt.default.bold(r.name)}`,i=(0,Vr.format)("Too many argument(s) %s. Got %s, expected %s",s,pt.default.bold.redBright(o),pt.default.bold.greenBright(n));super(i,{command:r})}};function Nt(t,r,e){if(Array.isArray(r))return r.map(o=>Nt(t,o,e));if(!t.test(r+""))throw new C({validator:t,value:r,context:e});return r}function Rt(t,r,e){if(Array.isArray(r))r.forEach(o=>Rt(t,o,e));else if(t.includes(r)===!1)throw new C({validator:t,value:r,context:e});return r}async function St(t,r,e){if(Array.isArray(r))return Promise.all(r.map(o=>St(t,o,e)));try{return await t(r)}catch(o){throw new C({validator:t,value:r,error:o,context:e})}}var _r=m(require("lodash/flatMap"));function Vt(t,r,e,o=!1){if(!o&&er(t))return Ze(t,r,e);if(Array.isArray(r))throw new C({error:"Expected a scalar value, got an array",value:r,validator:t,context:e});return ft(t)?Xe(t,r,e):B(t)?to(r):b(t)?Qe(r,e):r}function Qe(t,r){if(typeof t=="boolean")return t;if(/^(true|false|yes|no|0|1)$/i.test(String(t))===!1)throw new C({value:t,validator:2,context:r});return/^0|no|false$/.test(String(t))===!1}function Xe(t,r,e){let o=r+"";if(Array.isArray(r)||!J(o))throw new C({value:r,validator:t,context:e});return parseFloat(o)}function Ze(t,r,e){let o=typeof r=="string"?r.split(","):Array.isArray(r)?r:[r];return(0,_r.default)(o,n=>Vt(t,n,e,!0))}function to(t){return t+""}function dt(t,r,e){return typeof r=="function"?St(r,t,e):r instanceof RegExp?Nt(r,t,e):Array.isArray(r)?Rt(r,t,e):P(r)?Vt(r,t,e):t}function kr(t,r){return t.args.find(e=>e.name===r)}function ro(t){return t.args.filter(r=>r.required).length}function eo(t,r){let e={};return t.args.reduce((o,n,s)=>(r[s]!==void 0?o[n.name]=r[s]:n.default!==void 0&&(o[n.name]=n.default),o),e)}function oo(t){return t.args.some(r=>r.variadic)}function no(t){let r=ro(t),e=oo(t)?1/0:t.args.length;return{min:r,max:e}}function so(t,r,e){let o=t.args.reduce((n,s)=>(r[s.name]===void 0&&s.required&&n.push(new G(s,t)),n),[]);if(t.strictArgsCount){let n=io(t,e);n&&o.push(n)}return o}function io(t,r){let e=no(t),o=Object.keys(r).length;if(e.max!==1/0&&e.max<Object.keys(r).length)return new lt(t,e,o)}function Pr(t,r){let e=t.name.split(" ").length;return r.slice(e)}function ao(t,r){return t.validator?dt(r,t.validator,t):r}async function Br(t,r){let e=t.isProgramCommand()?r:Pr(t,r),o=eo(t,e),n=[],s=(0,_t.default)(o,(a,p,d)=>{let u=kr(t,d);try{if(!u)throw new l(`Unknown argumment ${d}`);a[d]=ao(u,p)}catch(f){n.push(f)}return a},{}),i=await(0,_t.default)(s,async(a,p,d)=>{let u=await a;return u[d]=await p,u},Promise.resolve({}));return n.push(...so(t,i,e)),{args:i,errors:n}}var kt=m(require("lodash/reduce"));function Lr(t,r){return t.options.find(e=>e.allNames.find(o=>o===r))}function mo(t,r){return t.validator?dt(r,t.validator,t):r}function po(t,r){return t.options.reduce((e,o)=>(r[o.name]===void 0&&o.required&&e.push(new D(o,t)),e),[])}function lo(t,r){return t.options.reduce((e,o)=>(e[o.name]===void 0&&o.default!==void 0&&(e[o.name]=o.default),e),r)}async function Hr(t,r){r=lo(t,r);let e=[],o=(0,kt.default)(r,(...s)=>{let[i,a,p]=s,d=Ar(p)||Lr(t,p);try{if(d)i[p]=mo(d,a);else if(t.strictOptions)throw new it(p,t)}catch(u){e.push(u)}return i},{}),n=await(0,kt.default)(o,async(s,i,a)=>{let p=await s;return p[a]=await i,p},Promise.resolve({}));return e.push(...po(t,n)),{options:n,errors:e}}async function Mr(t,r){let{args:e,options:o}=r,{options:n,errors:s}=await Hr(t,o),{args:i,errors:a}=await Br(t,e);return{...r,args:i,options:n,errors:[...a,...s]}}function uo(t){return t.substring(0,1)==="<"}function co(t){return t.substr(-4,3)==="..."||t.endsWith("...")}function Ir(t){t=t.trim();let r=U(t,!1),e=U(t),o=uo(t),n=co(t),s=o?`<${r}${n?"...":""}>`:`[${r}${n?"...":""}]`;return{name:e,synopsis:s,required:o,variadic:n}}function jr(t,r,e={}){let{validator:o,default:n}=e;Y(o);let s=Ir(t),i={kind:"argument",default:n,description:r,choices:Array.isArray(o)?o:[],validator:o,...s};return i.typeHint=Q(i),i}var Bt=m(require("lodash/map")),Gr=m(require("lodash/zipObject")),Dr=m(require("lodash/invert")),$r=m(require("lodash/pickBy"));function Fr(t){let r=(0,Bt.default)(t.options,"name"),e=(0,Bt.default)(t.options,n=>n.shortName||n.longName),o=(0,Gr.default)(r,e);return(0,$r.default)({...o,...(0,Dr.default)(o)})}function ut(t){let r=t,e=t;return{reset(){return e=r,e},get(o){return e[o]},getAll(){return e},set(o){return e={...e,...o},e}}}var ct="__self_cmd",Lt="help",H=class{constructor(r,e,o,n={}){this._aliases=[];this.options=[];this.args=[];this.program=r,this._name=e,this.description=o,this._config=ut({visible:!0,...n})}alias(...r){return this._aliases.push(...r),this}get name(){return this.isProgramCommand()?"":this._name}argument(r,e,o={}){return this._lastAddedArgOrOpt=jr(r,e,o),this.args.push(this._lastAddedArgOrOpt),this}action(r){return this._action=r,this}command(r,e,o={}){return this.program.command(r,e,o)}default(){return this.program.defaultCommand=this,this}hasAlias(r){return this._aliases.includes(r)}getAliases(){return this._aliases}isProgramCommand(){return this._name===ct}isHelpCommand(){return this._name===Lt}hide(){return this.configure({visible:!1})}option(r,e,o={}){let n=this._lastAddedArgOrOpt=h(r,e,o);return this.options.push(n),this}getParserConfig(){let r={boolean:[],string:[],alias:Fr(this),autoCast:this.autoCast,variadic:[],ddash:!1},e=this.options.reduce((o,n)=>(n.boolean&&o.boolean.push(n.name),B(n.validator)&&o.string.push(n.name),n.variadic&&o.variadic.push(n.name),o),r);return e=this.args.reduce((o,n,s)=>(this.isProgramCommand()||s++,b(n.validator)&&o.boolean.push(s),B(n.validator)&&o.string.push(s),n.variadic&&o.variadic.push(s),o),e),e}get synopsis(){let r=this.options.length?this.options.some(o=>o.required)?"<OPTIONS...>":"[OPTIONS...]":"",e=this._name!==ct?" "+this._name:"";return(this.program.getBin()+e+" "+this.args.map(o=>o.synopsis).join(" ")+" "+r).trim()}help(r,e={}){return Z(this,r,e),this}configure(r){return this._config.set(r),this}getConfigProperty(r){return this._config.get(r)}get autoCast(){return this.getConfigProperty("autoCast")??this.program.getConfigProperty("autoCast")}complete(r){if(!this._lastAddedArgOrOpt)throw new Error("Caporal setup error: you should only call `.complete()` after .argument() or .option().");return hr(this._lastAddedArgOrOpt,r),this}strict(r=!0){return this.configure({strictArgsCount:r,strictOptions:r})}get strictOptions(){return this.getConfigProperty("strictOptions")??this.program.getConfigProperty("strictOptions")}get strictArgsCount(){return this.getConfigProperty("strictArgsCount")??this.program.getConfigProperty("strictArgsCount")}cast(r){return this.configure({autoCast:r})}get visible(){return this.getConfigProperty("visible")}async run(r){let e={args:[],options:{},line:"",rawOptions:{},rawArgv:[],ddash:[],...r};try{let o=await Mr(this,e),{args:n,options:s,ddash:i,errors:a}=o;if(await ot(o,this.program,this))return-1;if(a.length)throw new F(this,a);if(!this._action)throw new z(this);return await this._action({args:n,options:s,ddash:i,logger:c,program:this.program,command:this})}catch(o){let n=Object.getPrototypeOf(o).constructor.name;throw o instanceof l&&n!=="Error"?o:new j(o)}}};function v(...t){return new H(...t)}var Ht=m(require("path")),Ur=m(require("lodash/zipObject")),Kr=m(require("lodash/map"));var zr=require("glob"),qr=m(require("fs"));function Wr(t,r="js,ts"){return qr.default.existsSync(t)?(0,zr.glob)(`**/*.{${r}}`,{cwd:t}):Promise.reject(new Error(`'${t}' does not exist!`))}async function Jr(t,r){let e=await Wr(r),o=await Promise.all(e.map(s=>rt(Ht.default.join(r,s)))),n=(0,Ur.default)(e,o);return(0,Kr.default)(n,(s,i)=>{let{dir:a,name:p}=Ht.default.parse(i),d=a?[...a.split("/"),p].join(" "):p,u={createCommand:v.bind(null,t,d),program:t};return s(u)})}var Yr=m(require("path"));function Qr(){try{return require(Yr.default.join(__filename,"..","..","..","package.json")).version}catch{}}var go="CAPORAL_LOG_LEVEL",M=class extends Xr.EventEmitter{constructor(){super();this.commands=[];this._programmaticMode=!1;this.NUMBER=1;this.STRING=4;this.ARRAY=8;this.BOOLEAN=2;this._bin=te.default.basename(process.argv[1]),this._version=Qr(),this._config=ut({strictArgsCount:!0,strictOptions:!0,autoCast:!0,logLevelEnvVar:go}),this.setupHelpCommand(),this.setupErrorHandlers()}setupErrorHandlers(){process.once("unhandledRejection",e=>{if(this._programmaticMode)throw e;this.emit("error",e)}),this.on("error",zt)}get progCommand(){return this._progCommand===void 0&&(this._progCommand=v(this,ct,"")),this._progCommand}setupHelpCommand(){return this.command(Lt,"Get help about a specific command").argument("[command]","Command name to get help for. If the command does not exist, global help will be displayed.").action(async e=>{let{args:o}=e,n=o.command?await et(this,[o.command]):void 0;return Et({...e,command:n}),-1}).hide()}help(e,o={}){return Z(this,e,o),this}strict(e=!0){return this.configure({strictArgsCount:e,strictOptions:e})}configure(e){return this._config.set(e),this}getConfigProperty(e){return this._config.get(e)}async getSynopsis(){return(this.getBin()+" "+(await this.hasCommands()?"<command> ":"")+"[ARGUMENTS...] [OPTIONS...]").trim()}get discoveryPath(){return this._discoveryPath}getVersion(){return this._version}version(e){return this._version=e,this}name(e){return this._name=e,this}getName(){return this._name}getDescription(){return this._description}description(e){return this._description=e,this}getBin(){return this._bin}bin(e){return this._bin=e,this}logger(e){return $t(e),this}getLogger(){return Ft()}disableGlobalOption(e){return Or(e)||c.warn("Cannot disable global option %s. Either the global option does not exist or has already been disabled."),this}getCommands(){return this.commands}command(e,o,n={}){let s=v(this,e,o,n);return this.commands.push(s),s}async hasCommands(){return(await this.getAllCommands()).length>1}async getAllCommands(){let e=await this.scanCommands();return[...this.commands,...e]}getLogLevelOverride(){return process.env[this.getConfigProperty("logLevelEnvVar")]}cast(e){return this.configure({autoCast:e})}action(e){return this.progCommand.action(e),this}argument(e,o,n={}){return this.progCommand.argument(e,o,n)}option(e,o,n={}){if(n.global){let s=h(e,o,n);br(s,n.action)}else this.progCommand.option(e,o,n);return this}discover(e){let o;try{o=Zr.default.statSync(e)}catch{}if(!o||!o.isDirectory())throw new Error("Caporal setup error: parameter `dirPath` of discover() should be a directory");return this._discoveryPath=e,this}async scanCommands(){return this._discoveryPath===void 0?[]:this._discoveredCommands?this._discoveredCommands:(this._discoveredCommands=await Jr(this,this._discoveryPath),this._discoveredCommands)}reset(){return this.commands=[],this._progCommand=void 0,this.setupHelpCommand(),this}async run(e){e||(process.env.CAPORAL_CMD_LINE?e=process.env.CAPORAL_CMD_LINE.split(" ").slice(1):e=process.argv.slice(2));let o=await this.findCommand(e),n=S(o?.getParserConfig(),e);return this._run(n,o)}async findCommand(e){let o=await et(this,e);if(o)return o;if(!(e.every(n=>n==="--help")&&!this._progCommand))return this.defaultCommand||this._progCommand}async _run(e,o){let n=this.getLogLevelOverride();if(n&&Object.keys(c.levels).includes(n)&&(c.level=n),!o){let i={...e,errors:[],args:{}};if(await ot(i,this))return this.emit("run"),-1;throw new mt(this,e.rawArgv[0])}let s=await o.run(e);return this.emit("run",s),s}async exec(e,o={},n=[]){this._programmaticMode=!0;let s=await this.findCommand(e);return o=(0,ee.default)(o,(i,a)=>(0,re.default)(a)),this._run({args:e,options:o,line:e.join(" "),rawOptions:o,rawArgv:e,ddash:n},s)}};var ne=m(require("chalk")),oe=new M,fo=oe;0&&(module.exports={CaporalValidator,Command,OptionValueType,Program,chalk,parseArgv,parseLine,program});
//# sourceMappingURL=index.js.map