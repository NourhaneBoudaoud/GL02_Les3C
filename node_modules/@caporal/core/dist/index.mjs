var hr=Object.defineProperty;var Nt=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(r,e)=>(typeof require<"u"?require:r)[e]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var Cr=(t,r)=>{for(var e in r)hr(t,e,{get:r[e],enumerable:!0})};import{EventEmitter as ro}from"events";import eo from"fs";import oo from"path";import no from"lodash/kebabCase";import so from"lodash/mapKeys";import er from"lodash/reduce";var p=class extends Error{constructor(e,o={}){super(e);Object.setPrototypeOf(this,new.target.prototype),this.name=this.constructor.name,this.meta=o,Error.captureStackTrace(this,this.constructor)}};var _=class extends p{constructor(r){let e=typeof r=="string"?r:r.message;super(e,{error:r})}};import{createLogger as yr,transports as Pr,format as at}from"winston";import{inspect as Or}from"util";import{default as k,supportsColor as br}from"chalk";import Ar from"lodash/replace";import{EOL as v}from"os";var Rt=at.printf(t=>{let{level:r,...e}=t,{message:o}=t,n="",s=wr(r),i=xr(e);if(i!==""&&(o+=`${v}${s}: ${i}`),r==="error"){let a=" ".repeat(e.paddingLeft||7);n=v,o=`${Ar(o,new RegExp(v,"g"),v+a)}${v}`}return`${n}${s}: ${o}`});function xr(t){return delete t.message,delete t[Symbol.for("level")],delete t[Symbol.for("message")],delete t[Symbol.for("splat")],Object.keys(t).length?Or(t,{showHidden:!1,colors:u.colorsEnabled}):""}function wr(t){if(!u.colorsEnabled)return t;let r=t;switch(t){case"error":r=k.bold.redBright(t);break;case"warn":r=k.hex("#FF9900")(t);break;case"info":r=k.hex("#569cd6")(t);break;case"debug":case"silly":r=k.dim(t);break}return r}var u=Tr();function St(t){u=t}function Vt(){return u}function Tr(){let t=yr({transports:[new Pr.Console({format:at.combine(at.splat(),Rt)})]});return t.disableColors=()=>{t.transports[0].format=Rt,t.colorsEnabled=!1},t.colorsEnabled=br!==!1,t}function _t(t){u.level=="debug"?u.log({level:"error",...t,message:t.message+`

`+t.stack,stack:t.stack,name:t.name}):u.error(t.message),process.exitCode=1}var E=class extends p{constructor(r){super("Caporal setup error: Invalid flag validator setup.",{validator:r})}};import vr from"chalk";var B=class extends p{constructor(r,e){let o=`Missing required argument ${vr.bold(r.name)}.`;super(o,{argument:r,command:e})}};import Er from"chalk";var L=class extends p{constructor(r,e){let o=`Missing required flag ${Er.bold(r.allNotations.join(" | "))}.`;super(o,{flag:r,command:e})}};import Nr from"chalk";import H from"chalk";function M(t){return t.replace(/<([^>]+)>/gi,r=>H.hex("#569cd6")(r)).replace(/<command>/gi,r=>H.hex("#ff9900")(r)).replace(/\[([^[\]]+)\]/gi,r=>H.hex("#aaa")(r)).replace(/ --?([^\s,]+)/gi,r=>H.green(r))}var I=class extends p{constructor(r,e){let n=`The following error${e.length>1?"s":""} occured:
`+e.map(s=>"- "+s.message.replace(/\n/g,`
  `)).join(`
`)+`

`+Nr.dim("Synopsis: ")+M(r.synopsis);super(n,{errors:e})}};var j=class extends p{constructor(r){let e;r&&!r.isProgramCommand()?e=`Caporal Error: You haven't defined any action for command '${r.name}'.
Use .action() to do so.`:e=`Caporal Error: You haven't defined any action for program.
Use .action() to do so.`,super(e,{cmd:r})}};var G=class extends p{constructor(r){super(`Syntax error in option synopsis: ${r}`,{synopsis:r})}};import Rr from"lodash/camelCase";import Sr from"lodash/kebabCase";var w=(n=>(n[n.NUMBER=1]="NUMBER",n[n.BOOLEAN=2]="BOOLEAN",n[n.STRING=4]="STRING",n[n.ARRAY=8]="ARRAY",n))(w||{}),mt=(o=>(o[o.Optional=0]="Optional",o[o.Required=1]="Required",o[o.None=2]="None",o))(mt||{});var Vr=/^-[a-z]$/i,_r=/^--[a-z]{2,}/i,kr=/^(-[a-zA-Z]|--\D{1}[\w-]+)/;function Br(t){return Vr.test(t)}function Lr(t){return _r.test(t)}function kt(t){return t.length===1?t:Rr(t)}function D(t,r=!0){return t=t.replace(/([[\]<>]+)/g,"").replace("...","").replace(/^no-/,""),r?kt(t):t}function $(t){let r=Math.min(t.length,2);return"-".repeat(r)+Sr(t)}function F(t){return!isNaN(parseFloat(t))&&isFinite(Number(t))}function T(t){return t!==void 0&&t!=="--"&&kr.test(t)}function Bt(t){return t.match(/^-([a-z]{2,})/i)?t.substr(1).split(""):!1}function Lt(t){return t.substr(0,5)==="--no-"}function Ht(t){return Array.isArray(t)}function pt(t){return kt(t.replace(/^--?(no-)?/,""))}function Mt(t){let r={variadic:!1,valueType:2,valueRequired:!1,allNames:[],allNotations:[],name:"",notation:"",synopsis:t},e=t.split(/[\s\t,]+/).reduce((n,s)=>(Lr(s)?(n.longNotation=s,n.longName=D(s.substring(2)),n.allNames.push(n.longName),n.allNotations.push(s)):Br(s)?(n.shortNotation=s,n.shortName=s.substring(1),n.allNames.push(n.shortName),n.allNotations.push(s)):s.substring(0,1)==="["?(n.valueType=0,n.valueRequired=!1,n.variadic=s.substr(-4,3)==="..."):s.substring(0,1)==="<"&&(n.valueType=1,n.valueRequired=!0,n.variadic=s.substr(-4,3)==="..."),n),r);if(e.longName===void 0&&e.shortName===void 0)throw new G(t);return e.name=e.longName||e.shortName,e.notation=e.longNotation||e.shortNotation,{...e}}import Hr from"lodash/isNumber";function y(t){return typeof t!="number"?!1:(Mr()&t)===t}function lt(t){return y(t)&&!!(t&1)}function N(t){return y(t)&&!!(t&4)}function P(t){return y(t)&&!!(t&2)}function It(t){return y(t)&&!!(t&8)}function Mr(){return Object.values(w).filter(Hr).reduce((t,r)=>t|r,0)}function Ir(t){if(!y(t))throw new E(t)}function jr(t){if(typeof t!="function"&&!(t instanceof RegExp)&&!Array.isArray(t))throw new E(t)}function z(t){t!==void 0&&(typeof t=="number"?Ir(t):jr(t))}function q(t){let r;if(P(t.validator)||"boolean"in t&&t.boolean&&t.default!==!1)r="boolean";else if(lt(t.validator))r="number";else if(Array.isArray(t.validator)){let e=JSON.stringify(t.validator);e.length<300&&(r="one of "+e.substr(1,e.length-2))}return r}import Yr from"lodash/replace";import Qr from"chalk";import{table as Gr,getBorderCharacters as Dr}from"table";import $r from"lodash/filter";function jt(t,r={}){return Gr(t,{border:Dr("void"),columnDefault:{paddingLeft:0,paddingRight:2},columns:{0:{paddingLeft:4,width:35},1:{width:55,wrapWord:!0,paddingRight:0}},drawHorizontalLine:()=>!1,...r})}function Gt(t){return t.default!==void 0&&!("boolean"in t&&t.boolean&&t.default===!1)?"default: "+JSON.stringify(t.default):void 0}function Fr(t,{eol:r,chalk:e}){return t.synopsis+(t.required&&t.default===void 0?r+e.dim("required"):"")}function R(t,r,e="OPTIONS"){if(t=$r(t,"visible"),!t.length)return"";let{chalk:o,eol:n,table:s,spaces:i}=r,a=i+o.bold(e)+n+n,m=t.map(l=>{let d=Gt(l),c=[l.typeHint,d].filter(x=>x).join(", "),C=Fr(l,r),b=l.description+(c.length?n+o.dim(c):"");return[C,b]});return a+s(m)}function Dt(t,r,e="ARGUMENTS"){if(!t.length)return"";let{chalk:o,eol:n,eol2:s,table:i,spaces:a}=r,m=a+o.bold(e)+s,l=t.map(d=>{let c=Gt(d),C=[d.typeHint,c].filter(x=>x).join(", "),b=d.description+(C.length?n+o.dim(C):"");return[d.synopsis,b]});return m+i(l)}function $t(t,r,e="COMMANDS"){let{chalk:o,prog:n,eol2:s,table:i,spaces:a}=r,m=`Type '${n.getBin()} help <command>' to get some help about a command`,l=a+o.bold(e)+` ${o.dim("\u2014")} `+o.dim(m)+s,d=t.filter(c=>c.visible).map(c=>[o.hex("#ff9900")(c.name),c.description||""]);return l+i(d)}var dt={};Cr(dt,{command:()=>qr,custom:()=>Jr,header:()=>Wr,program:()=>Ur,usage:()=>Kr});import zr from"lodash/sortBy";var qr=async t=>{let{cmd:r,globalOptions:e,eol:o,eol3:n,colorize:s,tpl:i}=t,a=zr(r.options,"name"),m=Array.from(e.keys()),l=r.synopsis+n+await i("custom",t)+Dt(r.args,t)+o+R(a,t)+o+R(m,t,"GLOBAL OPTIONS");return s(l)};var Wr=t=>{let{prog:r,chalk:e,spaces:o,eol:n,eol2:s}=t,i=process.env?.NODE_ENV==="test"?"":r.getVersion();return n+o+(r.getName()||r.getBin())+" "+(i||"")+(r.getDescription()?" \u2014 "+e.dim(r.getDescription()):"")+s};var Ur=async t=>{let{prog:r,globalOptions:e,eol:o,eol3:n,colorize:s,tpl:i}=t,a=await r.getAllCommands(),m=Array.from(e.keys()),l=await r.getSynopsis()+n+await i("custom",t)+$t(a,t)+o+R(m,t,"GLOBAL OPTIONS");return s(l)};var Kr=async t=>{let{tpl:r,prog:e,chalk:o,spaces:n,eol:s}=t,{cmd:i}=t;!i&&!await e.hasCommands()&&(t.cmd=i=e.progCommand);let a=`${n+o.bold("USAGE")} ${i?.name?"\u2014 "+o.dim(i.name):""}
  ${s+n+n+o.dim("\u25B8")} `,m=i?await r("command",t):await r("program",t);return a+m};var Jr=t=>{let{prog:r,cmd:e,eol2:o,eol3:n,chalk:s,colorize:i,customHelp:a,indent:m}=t,l=a.get(e||r);if(l){let d=l.map(({text:c,options:C})=>{let b="";C.sectionName&&(b+=s.bold(C.sectionName)+o);let x=C.colorize?i(c):c;return b+=C.sectionName?m(x):x,b+n}).join("");return m(d)+n}return""};var Xr=new Map(Object.entries(dt)),ut=new Map;function W(t,r,e){let o={sectionName:"",colorize:!0,...e},n=ut.get(t)||[];n.push({text:r,options:o}),ut.set(t,n)}async function ct(t,r){let e=Xr.get(t);if(!e)throw Error(`Caporal setup error: Unknown help template '${t}'`);return e(r)}function Zr(t,r){let e=" ".repeat(2);return{prog:t,cmd:r,chalk:Qr,colorize:M,customHelp:ut,tpl:ct,globalOptions:O(),table:jt,spaces:e,indent(n,s=e){return s+Yr(n.trim(),/(\r\n|\r|\n)/g,`
`+s)},eol:`
`,eol2:`

`,eol3:`


`}}async function Ft(t,r){let e=Zr(t,r);return[await ct("header",e),await ct("usage",e)].join("")}import qt from"tabtab";import te from"lodash/invert";import re from"lodash/findIndex";var ee="--";function U(t){return t===ee}function oe(t){return typeof t=="boolean"?t:/^true|1|yes|on$/.test(t)}function ne(t){return t+""}function ft(t){return/^true|false$/.test(t)?t==="true":F(t)?parseFloat(t):t}function gt(t,r,e){let o=pt(t);return e.string.includes(o)?ne(r):e.boolean.includes(o)||typeof r=="boolean"?oe(r):e.autoCast?ft(r):r}function se(t,r={}){return S(r,t.split(" "))}function ie(t){let r=t.indexOf("--"),e=re(t,T);return r<e&&r!==-1?-1:e}var ht=class{constructor(r){this.argv=r;this.ddashHandled=!1;this.cursor=0}toJSON(){return{cursor:this.cursor,ddashHandled:this.ddashHandled,current:this.current,argv:this.argv}}markDdashHandled(){return this.ddashHandled=!0,this}hasDdashHandled(){return this.ddashHandled}next(){return this.argv[this.cursor+1]}slice(r,e){return this.argv.slice(r,e)}sliceFromHere(r){return this.slice(this.cursor,r)}forward(r=1){return r===-1?this.end():(this.cursor+=r,!0)}end(){return this.cursor=this.length,!0}get current(){return this.argv[this.cursor]}get length(){return this.argv.length}},Ct=class{constructor(r,e){this.config=r;this.args=[];this.ddash=[];this.key="args";this.line=e.join(" "),this.rawArgv=e}toJSON(){return{args:this.args,ddash:this.ddash,rawArgv:this.rawArgv,line:this.line}}inVariadicContext(){let r=this[this.key].length;if(this.config.variadic.includes(r)&&(this.variadicId=r),this.variadicId!==void 0)return!0}markDdashHandled(r){return this.config.ddash&&(this.key="ddash"),r.markDdashHandled().forward()}push(...r){return this[this.key].push(...r.map(this.config.autoCast?ft:String)),!0}pushVariadic(r){let e=r.sliceFromHere(),o=ie(e);return this.variadicId=this.variadicId||0,(this[this.key][this.variadicId]=this[this.key][this.variadicId]||[]).push(...e.slice(0,o===-1?void 0:o).filter(s=>!U(s)).map(this.config.autoCast?ft:String)),r.forward(o)}visit(r){return!r.current||T(r.current)&&!r.hasDdashHandled()?!1:U(r.current)?this.markDdashHandled(r):this.inVariadicContext()?this.pushVariadic(r):(this.push(r.current),r.forward())}},yt=class{constructor(r){this.config=r;this.options={};this.rawOptions={}}toJSON(){return{options:this.options,rawOptions:this.rawOptions}}handleOptWithoutValue(r,e){let o=e.next(),n=T(o)||U(o)||o===void 0;this.compute(r,gt(r,n?!0:o,this.config)),n||e.forward()}handleConcatenatedOpts(r,e,o){if(o===void 0){o=!0;let n=r.next(),s=e[e.length-1],i=this.config.alias[s];n&&!T(n)&&!U(n)&&!this.isBoolean(s,i)&&(r.forward(),o=n)}this.computeMulti(e,o)}visit(r){if(!r.current||!T(r.current)||r.hasDdashHandled())return!1;let[e,o]=r.current.split("=",2),n=Bt(e);return n?this.handleConcatenatedOpts(r,n,o):o?this.compute(e,gt(e,o,this.config)):this.handleOptWithoutValue(e,r),r.forward()}compute(r,e){let o=Lt(r),n=pt(r),s=this.config.alias[n];if(this.isVariadic(n,s)){let i=this.options[n];this.rawOptions[r]=this.options[n]=(Ht(i)?i:[i]).concat(e)}else this.rawOptions[r]=this.options[n]=o?!e:e;s&&(this.options[s]=this.options[n])}computeMulti(r,e){let o=r.length;r.forEach((n,s)=>{let i=this.config.alias[n];this.options[n]=s+1===o?gt(n,e,this.config):!0,this.rawOptions["-"+n]=this.options[n],i&&(this.options[i]=this.options[n])})}isVariadic(r,e){return r in this.options&&(this.config.variadic.includes(r)||this.config.variadic.includes(e))}isBoolean(r,e){return this.config.boolean.includes(r)||this.config.boolean.includes(e)}};function S(t={},r=process.argv.slice(2)){let e={autoCast:!0,ddash:!1,alias:{},boolean:[],string:[],variadic:[],...t};e.alias={...e.alias,...te(e.alias)};let o=new ht(r),n=new yt(e),s=new Ct(e,r),i=[s,n];for(;o.current;)i.some(a=>a.visit(o));return{...n.toJSON(),...s.toJSON()}}import zt from"path";async function K(t){let{dir:r,name:e}=zt.parse(t),n=await import(zt.join(r,e));return n.default??n}import ae from"path";async function J(t,r){let e=t.getCommands(),o=i=>e.find(a=>a.name===i||a.hasAlias(i)),n,s;for(s=0;s<r.length;s++){let i=r.slice(0,s+1).join(" ");if(r[s].startsWith("-"))break;n=o(i)||await me(t,i)||n}return n}async function me(t,r){if(t.discoveryPath===void 0)return;let e=r.split(" ").join("/");try{let o=ae.join(t.discoveryPath,e),n=await K(o),s={createCommand:A.bind(null,t,r),program:t};return n(s)}catch{}}import Mn from"lodash/filter";import jn from"lodash/flatMap";var pe=new Map;function Wt(t,r){pe.set(t,r)}async function Ut(t){return qt.install({name:t.getBin(),completer:t.getBin()})}async function Kt(t){return qt.uninstall({name:t.getBin()})}function f(t,r,e={}){let{validator:o,required:n,hidden:s}=e;n=!!n,z(o);let i=Mt(t),a=i.valueType===2||P(o);o&&!P(o)&&(a=!1);let m={kind:"option",default:a==!0?!!e.default:e.default,description:r,choices:Array.isArray(o)?o:[],...i,required:n,visible:!s,boolean:a,validator:o};return m.typeHint=q(m),m}var Ot=async({program:t,command:r})=>{let e=await Ft(t,r);return console.log(e),t.emit("help",e),!1},le=({program:t})=>(console.log(t.getVersion()),t.emit("version",t.getVersion()),!1),de=({logger:t})=>{t.disableColors()},ue=({logger:t})=>{t.level="silly"},ce=({logger:t})=>{t.level="warn"},ge=({logger:t})=>{t.silent=!0},fe=({program:t})=>Ut(t),he=({program:t})=>Kt(t),Pt;function O(){return Pt===void 0&&(Pt=Ce()),Pt}function Ce(){let t=f("-h, --help","Display global help or command-related help."),r=f("-v, --verbose","Verbose mode: will also output debug messages."),e=f("--quiet","Quiet mode - only displays warn and error messages."),o=f("--silent","Silent mode: does not output anything, giving no indication of success or failure other than the exit code."),n=f("-V, --version","Display version."),s=f("--no-color","Disable use of colors in output."),i=f("--install-completion","Install completion for your shell.",{hidden:!0}),a=f("--uninstall-completion","Uninstall completion for your shell.",{hidden:!0});return new Map([[t,Ot],[n,le],[s,de],[r,ue],[e,ce],[o,ge],[i,fe],[a,he]])}function Yt(t){let r=O();for(let[e]of r)if(e.allNames.includes(t)||e.allNotations.includes(t))return r.delete(e);return!1}function Qt(t,r){return O().set(t,r)}async function Y(t,r,e){let{options:o}=t,n={...t,logger:u,program:r,command:e},s=Object.entries(o).map(([a])=>{let m=ye(a);if(m)return m(n)});return(await Promise.all(s)).some(a=>a===!1)}function ye(t){for(let[r,e]of O())if(r.allNames.includes(t))return e}function Xt(t){for(let[r]of O())if(r.allNames.includes(t))return r}import Pe from"chalk";function Zt(t,r){if(t===r)return 0;if(!t.length||!r.length)return t.length||r.length;let e=0,o=0,n=0,s=[...Array(r.length+1).keys()];for(let i=0;i<t.length;i++){n=i,o=i+1;for(let a=0;a<r.length;a++)e=t[i]===r[a]?n:Math.min(n,s[a+1],o)+1,n=s[a+1],s[a]=o,o=e;s[s.length-1]=e}return e}var Oe=2,be=(t,r)=>t.distance-r.distance,Ae=t=>t.distance<=Oe,xe=(t,r)=>({suggestion:r,distance:Zt(t,r)});function Q(t,r){return r.map(e=>xe(t,e)).filter(Ae).sort(be).map(e=>e.suggestion)}function X(t,r){return[...r].map((e,o)=>e!=t.charAt(o)?Pe.bold.greenBright(e):e).join("")}import we from"chalk";import Te from"lodash/fp/filter";import ve from"lodash/fp/map";var Z=class extends p{constructor(r,e){let o=Te(m=>m.name.length>1),n=ve(m=>m.name),s=n([...o(e.options),...O().keys()]),i=Q(r,s),a=`Unknown option ${we.bold.redBright($(r))}. `;i.length&&(a+="Did you mean "+i.map(m=>X($(r),$(m))).join(" or maybe ")+" ?"),super(a,{flag:r,command:e})}};import bt from"chalk";import Ee from"lodash/flatMap";import Ne from"lodash/filter";var tt=class extends p{constructor(r,e){let o=Ne(Ee(r.getCommands(),s=>[s.name,...s.getAliases()])),n="";if(e){n=`Unknown command ${bt.bold(e)}.`;let s=Q(e,o);s.length&&(n+=" Did you mean "+s.map(i=>X(e,i)).join(" or maybe ")+" ?")}else n=`Unspecified command. Available commands are:
`+o.map(s=>bt.whiteBright(s)).join(", ")+`.

For more help, type ${bt.whiteBright(r.getBin()+" --help")}`;super(n,{command:e})}};import{format as V}from"util";import g from"chalk";function tr(t){return"allNotations"in t}var h=class extends p{constructor({value:r,error:e,validator:o,context:n}){let s=e instanceof Error?e.message:e,i=tr(n)?"option":"argument",a=tr(n)?n.allNotations.join("|"):n.synopsis;if(y(o))switch(o){case 1:s=V(`Invalid value for %s %s.
Expected a %s but got "%s".`,i,g.redBright(a),g.underline("number"),g.redBright(r));break;case 2:s=V(`Invalid value for %s %s.
Expected a %s (true, false, 0, 1), but got "%s".`,i,g.redBright(a),g.underline("boolean"),g.redBright(r));break;case 4:s=V(`Invalid value for %s %s.
Expected a %s, but got "%s".`,i,g.redBright(a),g.underline("string"),g.redBright(r));break}else Array.isArray(o)?s=V(`Invalid value for %s %s.
Expected one of %s, but got "%s".`,i,g.redBright(a),"'"+o.join("', '")+"'",g.redBright(r)):o instanceof RegExp&&(s=V(`Invalid value for %s %s.
Expected a value matching %s, but got "%s".`,i,g.redBright(a),g.whiteBright(o.toString()),g.redBright(r)));super(s+"")}};import{format as Re}from"util";import At from"chalk";var rt=class extends p{constructor(r,e,o){let n=e.min===e.max?`exactly ${e.min}.`:`between ${e.min} and ${e.max}.`,s=r.isProgramCommand()?"":`for command ${At.bold(r.name)}`,i=Re("Too many argument(s) %s. Got %s, expected %s",s,At.bold.redBright(o),At.bold.greenBright(n));super(i,{command:r})}};function xt(t,r,e){if(Array.isArray(r))return r.map(o=>xt(t,o,e));if(!t.test(r+""))throw new h({validator:t,value:r,context:e});return r}function wt(t,r,e){if(Array.isArray(r))r.forEach(o=>wt(t,o,e));else if(t.includes(r)===!1)throw new h({validator:t,value:r,context:e});return r}async function Tt(t,r,e){if(Array.isArray(r))return Promise.all(r.map(o=>Tt(t,o,e)));try{return await t(r)}catch(o){throw new h({validator:t,value:r,error:o,context:e})}}import Se from"lodash/flatMap";function vt(t,r,e,o=!1){if(!o&&It(t))return ke(t,r,e);if(Array.isArray(r))throw new h({error:"Expected a scalar value, got an array",value:r,validator:t,context:e});return lt(t)?_e(t,r,e):N(t)?Be(r):P(t)?Ve(r,e):r}function Ve(t,r){if(typeof t=="boolean")return t;if(/^(true|false|yes|no|0|1)$/i.test(String(t))===!1)throw new h({value:t,validator:2,context:r});return/^0|no|false$/.test(String(t))===!1}function _e(t,r,e){let o=r+"";if(Array.isArray(r)||!F(o))throw new h({value:r,validator:t,context:e});return parseFloat(o)}function ke(t,r,e){let o=typeof r=="string"?r.split(","):Array.isArray(r)?r:[r];return Se(o,n=>vt(t,n,e,!0))}function Be(t){return t+""}function et(t,r,e){return typeof r=="function"?Tt(r,t,e):r instanceof RegExp?xt(r,t,e):Array.isArray(r)?wt(r,t,e):y(r)?vt(r,t,e):t}function rr(t,r){return t.args.find(e=>e.name===r)}function Le(t){return t.args.filter(r=>r.required).length}function He(t,r){let e={};return t.args.reduce((o,n,s)=>(r[s]!==void 0?o[n.name]=r[s]:n.default!==void 0&&(o[n.name]=n.default),o),e)}function Me(t){return t.args.some(r=>r.variadic)}function Ie(t){let r=Le(t),e=Me(t)?1/0:t.args.length;return{min:r,max:e}}function je(t,r,e){let o=t.args.reduce((n,s)=>(r[s.name]===void 0&&s.required&&n.push(new B(s,t)),n),[]);if(t.strictArgsCount){let n=Ge(t,e);n&&o.push(n)}return o}function Ge(t,r){let e=Ie(t),o=Object.keys(r).length;if(e.max!==1/0&&e.max<Object.keys(r).length)return new rt(t,e,o)}function Jt(t,r){let e=t.name.split(" ").length;return r.slice(e)}function De(t,r){return t.validator?et(r,t.validator,t):r}async function or(t,r){let e=t.isProgramCommand()?r:Jt(t,r),o=He(t,e),n=[],s=er(o,(a,m,l)=>{let d=rr(t,l);try{if(!d)throw new p(`Unknown argumment ${l}`);a[l]=De(d,m)}catch(c){n.push(c)}return a},{}),i=await er(s,async(a,m,l)=>{let d=await a;return d[l]=await m,d},Promise.resolve({}));return n.push(...je(t,i,e)),{args:i,errors:n}}import sr from"lodash/reduce";function nr(t,r){return t.options.find(e=>e.allNames.find(o=>o===r))}function $e(t,r){return t.validator?et(r,t.validator,t):r}function Fe(t,r){return t.options.reduce((e,o)=>(r[o.name]===void 0&&o.required&&e.push(new L(o,t)),e),[])}function ze(t,r){return t.options.reduce((e,o)=>(e[o.name]===void 0&&o.default!==void 0&&(e[o.name]=o.default),e),r)}async function ir(t,r){r=ze(t,r);let e=[],o=sr(r,(...s)=>{let[i,a,m]=s,l=Xt(m)||nr(t,m);try{if(l)i[m]=$e(l,a);else if(t.strictOptions)throw new Z(m,t)}catch(d){e.push(d)}return i},{}),n=await sr(o,async(s,i,a)=>{let m=await s;return m[a]=await i,m},Promise.resolve({}));return e.push(...Fe(t,n)),{options:n,errors:e}}async function ar(t,r){let{args:e,options:o}=r,{options:n,errors:s}=await ir(t,o),{args:i,errors:a}=await or(t,e);return{...r,args:i,options:n,errors:[...a,...s]}}function qe(t){return t.substring(0,1)==="<"}function We(t){return t.substr(-4,3)==="..."||t.endsWith("...")}function mr(t){t=t.trim();let r=D(t,!1),e=D(t),o=qe(t),n=We(t),s=o?`<${r}${n?"...":""}>`:`[${r}${n?"...":""}]`;return{name:e,synopsis:s,required:o,variadic:n}}function pr(t,r,e={}){let{validator:o,default:n}=e;z(o);let s=mr(t),i={kind:"argument",default:n,description:r,choices:Array.isArray(o)?o:[],validator:o,...s};return i.typeHint=q(i),i}import lr from"lodash/map";import Ue from"lodash/zipObject";import Ke from"lodash/invert";import Je from"lodash/pickBy";function dr(t){let r=lr(t.options,"name"),e=lr(t.options,n=>n.shortName||n.longName),o=Ue(r,e);return Je({...o,...Ke(o)})}function ot(t){let r=t,e=t;return{reset(){return e=r,e},get(o){return e[o]},getAll(){return e},set(o){return e={...e,...o},e}}}var nt="__self_cmd",Et="help",st=class{constructor(r,e,o,n={}){this._aliases=[];this.options=[];this.args=[];this.program=r,this._name=e,this.description=o,this._config=ot({visible:!0,...n})}alias(...r){return this._aliases.push(...r),this}get name(){return this.isProgramCommand()?"":this._name}argument(r,e,o={}){return this._lastAddedArgOrOpt=pr(r,e,o),this.args.push(this._lastAddedArgOrOpt),this}action(r){return this._action=r,this}command(r,e,o={}){return this.program.command(r,e,o)}default(){return this.program.defaultCommand=this,this}hasAlias(r){return this._aliases.includes(r)}getAliases(){return this._aliases}isProgramCommand(){return this._name===nt}isHelpCommand(){return this._name===Et}hide(){return this.configure({visible:!1})}option(r,e,o={}){let n=this._lastAddedArgOrOpt=f(r,e,o);return this.options.push(n),this}getParserConfig(){let r={boolean:[],string:[],alias:dr(this),autoCast:this.autoCast,variadic:[],ddash:!1},e=this.options.reduce((o,n)=>(n.boolean&&o.boolean.push(n.name),N(n.validator)&&o.string.push(n.name),n.variadic&&o.variadic.push(n.name),o),r);return e=this.args.reduce((o,n,s)=>(this.isProgramCommand()||s++,P(n.validator)&&o.boolean.push(s),N(n.validator)&&o.string.push(s),n.variadic&&o.variadic.push(s),o),e),e}get synopsis(){let r=this.options.length?this.options.some(o=>o.required)?"<OPTIONS...>":"[OPTIONS...]":"",e=this._name!==nt?" "+this._name:"";return(this.program.getBin()+e+" "+this.args.map(o=>o.synopsis).join(" ")+" "+r).trim()}help(r,e={}){return W(this,r,e),this}configure(r){return this._config.set(r),this}getConfigProperty(r){return this._config.get(r)}get autoCast(){return this.getConfigProperty("autoCast")??this.program.getConfigProperty("autoCast")}complete(r){if(!this._lastAddedArgOrOpt)throw new Error("Caporal setup error: you should only call `.complete()` after .argument() or .option().");return Wt(this._lastAddedArgOrOpt,r),this}strict(r=!0){return this.configure({strictArgsCount:r,strictOptions:r})}get strictOptions(){return this.getConfigProperty("strictOptions")??this.program.getConfigProperty("strictOptions")}get strictArgsCount(){return this.getConfigProperty("strictArgsCount")??this.program.getConfigProperty("strictArgsCount")}cast(r){return this.configure({autoCast:r})}get visible(){return this.getConfigProperty("visible")}async run(r){let e={args:[],options:{},line:"",rawOptions:{},rawArgv:[],ddash:[],...r};try{let o=await ar(this,e),{args:n,options:s,ddash:i,errors:a}=o;if(await Y(o,this.program,this))return-1;if(a.length)throw new I(this,a);if(!this._action)throw new j(this);return await this._action({args:n,options:s,ddash:i,logger:u,program:this.program,command:this})}catch(o){let n=Object.getPrototypeOf(o).constructor.name;throw o instanceof p&&n!=="Error"?o:new _(o)}}};function A(...t){return new st(...t)}import cr from"path";import Xe from"lodash/zipObject";import Ze from"lodash/map";import{glob as Ye}from"glob";import Qe from"fs";function ur(t,r="js,ts"){return Qe.existsSync(t)?Ye(`**/*.{${r}}`,{cwd:t}):Promise.reject(new Error(`'${t}' does not exist!`))}async function gr(t,r){let e=await ur(r),o=await Promise.all(e.map(s=>K(cr.join(r,s)))),n=Xe(e,o);return Ze(n,(s,i)=>{let{dir:a,name:m}=cr.parse(i),l=a?[...a.split("/"),m].join(" "):m,d={createCommand:A.bind(null,t,l),program:t};return s(d)})}import to from"path";function fr(){try{return Nt(to.join(__filename,"..","..","..","package.json")).version}catch{}}var io="CAPORAL_LOG_LEVEL",it=class extends ro{constructor(){super();this.commands=[];this._programmaticMode=!1;this.NUMBER=1;this.STRING=4;this.ARRAY=8;this.BOOLEAN=2;this._bin=oo.basename(process.argv[1]),this._version=fr(),this._config=ot({strictArgsCount:!0,strictOptions:!0,autoCast:!0,logLevelEnvVar:io}),this.setupHelpCommand(),this.setupErrorHandlers()}setupErrorHandlers(){process.once("unhandledRejection",e=>{if(this._programmaticMode)throw e;this.emit("error",e)}),this.on("error",_t)}get progCommand(){return this._progCommand===void 0&&(this._progCommand=A(this,nt,"")),this._progCommand}setupHelpCommand(){return this.command(Et,"Get help about a specific command").argument("[command]","Command name to get help for. If the command does not exist, global help will be displayed.").action(async e=>{let{args:o}=e,n=o.command?await J(this,[o.command]):void 0;return Ot({...e,command:n}),-1}).hide()}help(e,o={}){return W(this,e,o),this}strict(e=!0){return this.configure({strictArgsCount:e,strictOptions:e})}configure(e){return this._config.set(e),this}getConfigProperty(e){return this._config.get(e)}async getSynopsis(){return(this.getBin()+" "+(await this.hasCommands()?"<command> ":"")+"[ARGUMENTS...] [OPTIONS...]").trim()}get discoveryPath(){return this._discoveryPath}getVersion(){return this._version}version(e){return this._version=e,this}name(e){return this._name=e,this}getName(){return this._name}getDescription(){return this._description}description(e){return this._description=e,this}getBin(){return this._bin}bin(e){return this._bin=e,this}logger(e){return St(e),this}getLogger(){return Vt()}disableGlobalOption(e){return Yt(e)||u.warn("Cannot disable global option %s. Either the global option does not exist or has already been disabled."),this}getCommands(){return this.commands}command(e,o,n={}){let s=A(this,e,o,n);return this.commands.push(s),s}async hasCommands(){return(await this.getAllCommands()).length>1}async getAllCommands(){let e=await this.scanCommands();return[...this.commands,...e]}getLogLevelOverride(){return process.env[this.getConfigProperty("logLevelEnvVar")]}cast(e){return this.configure({autoCast:e})}action(e){return this.progCommand.action(e),this}argument(e,o,n={}){return this.progCommand.argument(e,o,n)}option(e,o,n={}){if(n.global){let s=f(e,o,n);Qt(s,n.action)}else this.progCommand.option(e,o,n);return this}discover(e){let o;try{o=eo.statSync(e)}catch{}if(!o||!o.isDirectory())throw new Error("Caporal setup error: parameter `dirPath` of discover() should be a directory");return this._discoveryPath=e,this}async scanCommands(){return this._discoveryPath===void 0?[]:this._discoveredCommands?this._discoveredCommands:(this._discoveredCommands=await gr(this,this._discoveryPath),this._discoveredCommands)}reset(){return this.commands=[],this._progCommand=void 0,this.setupHelpCommand(),this}async run(e){e||(process.env.CAPORAL_CMD_LINE?e=process.env.CAPORAL_CMD_LINE.split(" ").slice(1):e=process.argv.slice(2));let o=await this.findCommand(e),n=S(o?.getParserConfig(),e);return this._run(n,o)}async findCommand(e){let o=await J(this,e);if(o)return o;if(!(e.every(n=>n==="--help")&&!this._progCommand))return this.defaultCommand||this._progCommand}async _run(e,o){let n=this.getLogLevelOverride();if(n&&Object.keys(u.levels).includes(n)&&(u.level=n),!o){let i={...e,errors:[],args:{}};if(await Y(i,this))return this.emit("run"),-1;throw new tt(this,e.rawArgv[0])}let s=await o.run(e);return this.emit("run",s),s}async exec(e,o={},n=[]){this._programmaticMode=!0;let s=await this.findCommand(e);return o=so(o,(i,a)=>no(a)),this._run({args:e,options:o,line:e.join(" "),rawOptions:o,rawArgv:e,ddash:n},s)}};import{default as Ba}from"chalk";var ao=new it,Ra=ao;export{w as CaporalValidator,st as Command,mt as OptionValueType,it as Program,Ba as chalk,Ra as default,S as parseArgv,se as parseLine,ao as program};
//# sourceMappingURL=index.mjs.map